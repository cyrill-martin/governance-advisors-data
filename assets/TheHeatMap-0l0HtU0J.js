import{d as o}from"./d3-importer-B_XtL1R2.js";import{_ as ne,J as se,u as re,aV as oe,a as ce,b as ue,o as de,r as c,w as h,s as A,c as ve,d as me,I as _}from"./index-V9ZHI5MU.js";import{u as Y}from"./updateUrl-CcC_rnb5.js";function be(D,l){let t;return function(...b){clearTimeout(t),t=setTimeout(()=>{D.apply(this,b)},l)}}const fe={id:"tooltip"},pe={__name:"TheHeatMap",setup(D){const l=se(),t=re(),{t:b}=oe(),M=ce(),V=ue();de(()=>{v.value=o.select("#tooltip")}),h(()=>t.allSet,()=>{C()}),h(()=>l.width,()=>{E()});const E=be(()=>{F()},500);function F(){o.select("#svg-visualization").remove(),C()}const v=c(null),z=c(null),p=c(null),n=c({width:null,height:null,margin:{top:null,right:null,bottom:null,left:null},ctrWidth:null,ctrHeight:null}),g=c([]),x=c([]),y=c([]),u=c(null),f=c(null),m=c(null),B=c(null),$=c(null);async function C(){t.mapDrawn=!1,g.value=await T(),x.value=await P(),y.value=await S(),await J(),await U(),await j(),await k(),await Z(),await q(),await w(),t.mapDrawn=!0}async function R(e){l.isMobile?e==="years"?W():L():e==="years"?L():W()}async function G(e){n.value.width=e.node().getBoundingClientRect().width;const a=l.isMobile?1.75:.25;n.value.height=l.width*a,n.value.margin.top=l.isMobile?155:10,n.value.margin.right=l.isMobile?10:25,n.value.margin.bottom=l.isMobile?10:40,n.value.margin.left=10,n.value.ctrWidth=n.value.width-n.value.margin.left-n.value.margin.right,n.value.ctrHeight=n.value.height-n.value.margin.top-n.value.margin.bottom}const H=A(()=>l.isMobile?25:170);async function J(){const e=o.select("#heat-map");await G(e),z.value=e.append("svg").attr("id","svg-visualization").attr("viewBox",`0 0 ${n.value.width} ${n.value.height}`),p.value=z.value.append("g").attr("id","visualization-ctr").attr("transform",`translate(${n.value.margin.left}, ${n.value.margin.top})`)}h(()=>t.selectedYearsRange,async()=>{t.allSet&&(g.value=await T(),await R("years"),await w(),Y(M,V))}),h(()=>t.selectedVariable,async()=>{t.allSet&&(x.value=await P(),y.value=await S(),await k(),await R("variable"),await w(),Y(M,V))}),h(()=>t.absoluteValues,async()=>{t.allSet&&(y.value=await S(),await k(),await w(),Y(M,V))});async function T(){const e=t.selectedYearsRange,a=e[0],s=e[1];let i;return a===s?i=[a]:a<s?i=Array.from({length:s-a+1},(r,d)=>a+d):i=Array.from({length:a-s+1},(r,d)=>a-d),l.isMobile?i.reverse():i}const O=["gender","skill","background","origin","independence"];async function P(){if(!t.selectedVariable)return null;let e=t.boardMembers[t.selectedVariable];const a=o.max(e,r=>r.Year);e=e.filter(r=>r.Year===a),O.includes(t.selectedVariable)?e=e.sort((r,d)=>d.Count-r.Count):e=e.sort((r,d)=>r[t.selectedVariable]-d[t.selectedVariable]);const s=new Set;return e.map(r=>b(`variables.${t.selectedVariable}.${r[t.selectedVariable]}`)).filter(r=>s.has(r)?!1:(s.add(r),!0))}async function S(){if(!t.selectedVariable)return null;if(t.absoluteValues){const e=o.extent(t.boardMembers[t.selectedVariable].map(s=>s.Count)),a=(e[0]+e[1])/2;return[e[0],a,e[1]]}else{const e=o.extent(t.boardMembers[t.selectedVariable].map(s=>s.Percentage)),a=(e[0]+e[1])/2;return[e[0],a,e[1]]}}const I=A(()=>t.allSet?l.isMobile?x.value:g.value:[""]),X=A(()=>t.allSet?l.isMobile?g.value:x.value:[""]);async function U(){u.value=o.scaleBand().domain(I.value).range([H.value,n.value.ctrWidth]).align(.5)}async function Z(){const e=l.isMobile?o.axisTop(u.value):o.axisBottom(u.value),a=l.isMobile?0:n.value.ctrHeight,s=l.isMobile?"-90":"-45",i=l.isMobile?"start":"end";f.value=p.value.append("g").attr("id","x-axis").attr("transform",`translate(0, ${a})`).style("font-size",()=>l.isMobile?"10px":"14px"),f.value.call(e.tickSize(0).tickPadding(8)),f.value.selectAll("text").attr("transform",`rotate(${s})`).style("text-anchor",`${i}`),l.isMobile&&f.value.selectAll("text").attr("dx","1.25em").attr("dy","1.5em")}async function L(){if(!u.value)return;const e=l.isMobile?o.axisTop(u.value):o.axisBottom(u.value),a=l.isMobile?"-90":"-45",s=l.isMobile?"start":"end";u.value.domain(I.value),f.value.call(e.tickSize(0).tickPadding(8)).selectAll("text").attr("transform",`rotate(${a})`).style("text-anchor",`${s}`),l.isMobile&&f.value.selectAll("text").attr("dx","1.25em").attr("dy","1.5em")}async function j(){m.value=o.scaleBand().domain(X.value).range([0,n.value.ctrHeight]).align(.5)}async function q(){B.value=p.value.append("g").attr("id","y-axis").attr("transform",`translate(${H.value}, 0)`).style("font-size",()=>l.isMobile?"10px":"14px").call(o.axisLeft(m.value).tickSize(0).tickPadding(8))}async function W(){m.value&&(m.value.domain(X.value),B.value.call(o.axisLeft(m.value).tickSize(0).tickPadding(8)))}async function k(){$.value=o.scaleLinear().domain(y.value).range(t.colors)}function N(e,a){return b(`variables.${e}.${a}`)}function K(e){const a=l.isMobile?N(t.selectedVariable,e[t.selectedVariable]):e.Year;return u.value(a)}function Q(e){const a=l.isMobile?e.Year:N(t.selectedVariable,e[t.selectedVariable]);return m.value(a)}function ee(e){return t.absoluteValues?$.value(e.Count):$.value(e.Percentage)}async function w(){const e=t.boardMembers[t.selectedVariable].filter(i=>g.value.includes(i.Year));let a=p.value.select(".rect-group");a.empty()&&(a=p.value.append("g").attr("class","rect-group"));const s=a.selectAll("rect").data(e,i=>`${i.Year}_${i[t.selectedVariable]}`);s.exit().remove(),s.enter().append("rect").attr("class","rectangle").merge(s).attr("x",i=>K(i)).attr("y",i=>Q(i)).attr("width",u.value.bandwidth()).attr("height",m.value.bandwidth()).attr("stroke","black").attr("stroke-width",1).attr("fill",i=>ee(i)).on("mouseover",function(i,r){o.select(this).attr("stroke-width",2.5).raise(),te(r)}).on("mousemove",i=>ae(i)).on("mouseout",function(){o.select(this).attr("stroke-width",1),le()})}function te(e){const a=e.Year,s=b(`variables.${t.selectedVariable}`),i=e.NumberOfBoardSeats,r=b(`variables.${t.selectedVariable}.${e[t.selectedVariable]}`),d=e.Count,ie=e.Percentage;v.value.select(".line-1").text(`${s}`).style("font-weight","bold"),v.value.select(".line-2").text(`${r} (${a}):`),v.value.select(".line-3").text(`${d} of ${i} seats (${ie}%)`),v.value.style("visibility","visible")}function ae(e){v.value.style("left",`${e.clientX+30}px`).style("top",`${e.clientY-80}px`)}function le(){v.value.style("visibility","hidden")}return(e,a)=>(me(),ve("div",fe,[...a[0]||(a[0]=[_("div",{class:"line-1"},null,-1),_("div",{class:"line-2"},null,-1),_("div",{class:"line-3"},null,-1)])]))}},ye=ne(pe,[["__scopeId","data-v-a909b83b"]]);export{ye as default};
